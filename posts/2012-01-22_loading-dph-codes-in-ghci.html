<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>8c6794b6.github.io - Loading dph codes in ghci</title>
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/ico">
    <link rel="stylesheet" type="text/css" href="../css/style.css">
    <link rel="stylesheet" type="text/css" href="../css/hk-tango.css">
    <link rel="alternate" type="application/rss+xml" title="8c6794b6" href="../rss.xml">
  </head>
  <body>
    <div>
      <div id="header">
        <div id="header_contents">
          <div id="header_left">
            <a href="../">8c6794b6.github.io</a>
          </div>
          <div id="navigation">
            <a href="../index.html">Home</a>
            <a href="../archive.html">Archive</a>
            <a href="../rss.xml">RSS</a>
          </div>
        </div>
      </div>
      <div id="content">
        <h1>Loading dph codes in ghci</h1>
<div id="post_date">
  <strong>January 22, 2012</strong>
</div>
<div class="post_tags">
  <strong>Tags: </strong><a href="../tags/haskell.html">haskell</a>, <a href="../tags/dph.html">dph</a>, <a href="../tags/ghc.html">ghc</a>, <a href="../tags/ghci.html">ghci</a>
</div>

<div id="post_body">
<p>In haddock of dph-par package, we see functions like below:</p>
<pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt; zipP ::</span> [<span class="fu">:</span>a<span class="fu">:</span>] <span class="ot">-&gt;</span> [<span class="fu">:</span>b<span class="fu">:</span>] <span class="ot">-&gt;</span> [<span class="fu">:</span>(a, b)<span class="fu">:</span>]
<span class="ot">&gt;</span> <span class="ot">{-# NOINLINE zipP #-}</span>
<span class="ot">&gt;</span> zipP <span class="fu">!</span>_ <span class="fu">!</span>_ <span class="fu">=</span> [<span class="ot">::</span>]
<span class="ot">&gt;</span> <span class="ot">{-# VECTORISE zipP = zipPA #-}</span></code></pre>
<p>Above difinition is from <a href="http://hackage.haskell.org/packages/archive/dph-par/0.5.1.1/doc/html/src/Data-Array-Parallel.html#zipP">dph-par-0.5.1.1</a>. From what its written, <code>zipP</code> looks like a function that returning an empty array. Though after compiling the code with appropriate options, <code>zipP</code> indeed work as parallel variant of <code>zip</code> for standard list.</p>
<p>As of GHC-7.2.2 and dph-par-0.5.1.1, we cannot directly load codes with parallel array in ghci. One way to load them in ghci is, prepare a wrapper with fixing the type of array element, and compile to object code.</p>
<p>Suppose that we have a module containing parallel array functions:</p>
<pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span> <span class="ot">{-# LANGUAGE ParallelArrays #-}</span>
<span class="ot">&gt;</span> <span class="ot">{-# OPTIONS_GHC -fvectorise #-}</span>
<span class="ot">&gt;</span> <span class="co">-- VectroseMe.hs</span>
<span class="ot">&gt;</span> <span class="kw">module</span> <span class="dt">VectoriseMe</span> <span class="kw">where</span>
<span class="ot">&gt;</span> 
<span class="ot">&gt;</span> <span class="kw">import</span> Data.Array.Parallel
<span class="ot">&gt;</span> <span class="kw">import</span> Data.Array.Parallel.PArray
<span class="ot">&gt;</span> 
<span class="ot">&gt; myZipP ::</span> [<span class="fu">:</span>a<span class="fu">:</span>] <span class="ot">-&gt;</span> [<span class="fu">:</span>b<span class="fu">:</span>] <span class="ot">-&gt;</span> [<span class="fu">:</span>(a, b)<span class="fu">:</span>]
<span class="ot">&gt;</span> myZipP as bs <span class="fu">=</span> zipP as bs
<span class="ot">&gt;</span> 
<span class="ot">&gt; myZipPA ::</span> <span class="dt">PArray</span> a <span class="ot">-&gt;</span> <span class="dt">PArray</span> b <span class="ot">-&gt;</span> <span class="dt">PArray</span> (a, b)
<span class="ot">&gt;</span> myZipPA as bs <span class="fu">=</span> toPArrayP (myZipP (fromPArrayP as) (fromPArrayP bs))
<span class="ot">&gt;</span> <span class="ot">{-# NOINLINE myZipPA #-}</span>
<span class="ot">&gt;</span> 
<span class="ot">&gt; myZipIntP ::</span> [<span class="fu">:</span><span class="dt">Int</span><span class="fu">:</span>] <span class="ot">-&gt;</span> [<span class="fu">:</span><span class="dt">Int</span><span class="fu">:</span>] <span class="ot">-&gt;</span> [<span class="fu">:</span>(<span class="dt">Int</span>, <span class="dt">Int</span>)<span class="fu">:</span>]
<span class="ot">&gt;</span> myZipIntP as bs <span class="fu">=</span> zipP as bs
<span class="ot">&gt;</span> 
<span class="ot">&gt; myZipIntPA ::</span> <span class="dt">PArray</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">PArray</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">PArray</span> (<span class="dt">Int</span>, <span class="dt">Int</span>)
<span class="ot">&gt;</span> myZipIntPA as bs <span class="fu">=</span> toPArrayP (myZipIntP (fromPArrayP as) (fromPArrayP bs))
<span class="ot">&gt;</span> <span class="ot">{-# NOINLINE myZipIntPA #-}</span></code></pre>
<p>And a wrapper which imports above module:</p>
<pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span> <span class="co">-- Wrapper.hs</span>
<span class="ot">&gt;</span> <span class="kw">module</span> <span class="dt">Wrapper</span> <span class="kw">where</span>
<span class="ot">&gt;</span> 
<span class="ot">&gt;</span> <span class="kw">import</span> Data.Array.Parallel
<span class="ot">&gt;</span> <span class="kw">import</span> Data.Array.Parallel.PArray (fromList)
<span class="ot">&gt;</span> 
<span class="ot">&gt;</span> <span class="kw">import</span> VectoriseMe
<span class="ot">&gt;</span> 
<span class="ot">&gt; main ::</span> <span class="dt">IO</span> ()
<span class="ot">&gt;</span> main <span class="fu">=</span> <span class="kw">do</span>
<span class="ot">&gt;</span>   putStrLn <span class="fu">$</span> concat [<span class="st">&quot;myZip_test:&quot;</span>, <span class="st">&quot;\n  &quot;</span>, show myZip_test]
<span class="ot">&gt;</span>   putStrLn <span class="fu">$</span> concat [<span class="st">&quot;myZipInt_test:&quot;</span>, <span class="st">&quot;\n  &quot;</span>, show myZipInt_test]
<span class="ot">&gt;</span> 
<span class="ot">&gt;</span> pa1,<span class="ot"> pa2 ::</span> <span class="dt">PArray</span> <span class="dt">Int</span>
<span class="ot">&gt;</span> pa1 <span class="fu">=</span> fromList [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]
<span class="ot">&gt;</span> pa2 <span class="fu">=</span> fromList [<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>]
<span class="ot">&gt;</span> 
<span class="ot">&gt; myZip_test ::</span> <span class="dt">PArray</span> (<span class="dt">Int</span>, <span class="dt">Int</span>)
<span class="ot">&gt;</span> myZip_test <span class="fu">=</span> myZipPA pa1 pa2
<span class="ot">&gt;</span> 
<span class="ot">&gt; myZipInt_test ::</span> <span class="dt">PArray</span> (<span class="dt">Int</span>, <span class="dt">Int</span>)
<span class="ot">&gt;</span> myZipInt_test <span class="fu">=</span> myZipIntPA pa1 pa2</code></pre>
<p>Loading Wrapper.hs in ghci and invoking the main function:</p>
<pre><code>| $ ghci -fdph-par -fobject-code -fforce-recomp Wrapper.hs
| GHCi, version 7.2.2: http://www.haskell.org/ghc/  :? for help
| Loading package ghc-prim ... linking ... done.
| Loading package integer-gmp ... linking ... done.
| Loading package base ... linking ... done.
| Loading package array-0.3.0.3 ... linking ... done.
| Loading package old-locale-1.0.0.3 ... linking ... done.
| Loading package time-1.2.0.5 ... linking ... done.
| Loading package random-1.0.1.1 ... linking ... done.
| Loading package primitive-0.3.1 ... linking ... done.
| Loading package vector-0.7.1 ... linking ... done.
| Loading package dph-base-0.5.1.1 ... linking ... done.
| Loading package dph-prim-interface-0.5.1.1 ... linking ... done.
| Loading package dph-prim-seq-0.5.1.1 ... linking ... done.
| Loading package old-time-1.0.0.7 ... linking ... done.
| Loading package dph-prim-par-0.5.1.1 ... linking ... done.
| Loading package containers-0.4.1.0 ... linking ... done.
| Loading package filepath-1.2.0.1 ... linking ... done.
| Loading package unix-2.5.0.0 ... linking ... done.
| Loading package directory-1.1.0.1 ... linking ... done.
| Loading package pretty-1.1.0.0 ... linking ... done.
| Loading package process-1.1.0.0 ... linking ... done.
| Loading package Cabal-1.12.0 ... linking ... done.
| Loading package bytestring-0.9.2.0 ... linking ... done.
| Loading package binary-0.5.0.2 ... linking ... done.
| Loading package bin-package-db-0.0.0.0 ... linking ... done.
| Loading package hoopl-3.8.7.1 ... linking ... done.
| Loading package hpc-0.5.1.0 ... linking ... done.
| Loading package template-haskell ... linking ... done.
| Loading package ghc-7.2.2 ... linking ... done.
| Loading package dph-par ... linking ... done.
| Loading package ffi-1.0 ... linking ... done.
| [1 of 2] Compiling VectoriseMe      ( VectoriseMe.hs, VectoriseMe.o )
| [2 of 2] Compiling Wrapper          ( Wrapper.hs, Wrapper.o )
| Ok, modules loaded: Wrapper, VectoriseMe.
| ghci&gt; main
| myZip_test:
|   fromList&lt;PArray&gt; []
| myZipInt_test:
|   fromList&lt;PArray&gt; [(1,4),(2,5),(3,6)]</code></pre>
<p>We see that <code>myZip_test</code> is showing empty list, and <code>myZipInt_test</code> is showing the zipped contents.</p>
</div>

      </div>
      <div id="footer">
        <div id="footer_content">
          <p>
            <a href="../index.html">Home</a> |
            <a href="../archive.html">Archive</a> |
            <a href="../rss.xml">RSS</a>
          </p>
          Site contents licensed under
          <a href="http://creativecommons.org/licenses/by/3.0/">
            CC Attribution 3.0
          </a>
        </div>
      </div>
    </div>
  </body>
</html>
